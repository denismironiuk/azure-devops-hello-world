trigger:
- main

pool:
  name: Default   # self-hosted –∞–≥–µ–Ω—Ç

variables:
  buildConfiguration: 'Release'
  buildVersion: '1.0.$(Build.BuildId)'   # –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç BuildId –æ—Ç Azure DevOps
  artifactName: 'drop_$(Build.BuildNumber)'   # –Ω–∞–ø—Ä–∏–º–µ—Ä drop_20251026.1

steps:
# 1Ô∏è‚É£ –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- checkout: self

# 2Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ .NET SDK
- task: UseDotNet@2
  inputs:
    packageType: 'sdk'
    version: '9.0.x'

# 3Ô∏è‚É£ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- script: |
    echo "üîß Restoring dependencies..."
    dotnet restore ./HelloWorld/HelloWorld.csproj
  displayName: "Restore dependencies"

# 4Ô∏è‚É£ –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
- script: |
    echo "‚öôÔ∏è Building project..."
    dotnet build ./HelloWorld/HelloWorld.csproj --configuration $(buildConfiguration) --output $(Build.ArtifactStagingDirectory)
  displayName: "Build project"

# 5Ô∏è‚É£ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
# - script: |
#     echo "üß™ Running tests..."
#     dotnet test ./HelloWorld/HelloWorld.csproj --configuration $(buildConfiguration)
#   displayName: "Run tests"

# 6Ô∏è‚É£ –ê—Ä—Ö–∏–≤–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å–±–æ—Ä–∫–∏
- task: ArchiveFiles@2
  inputs:
    rootFolderOrFile: '$(Build.ArtifactStagingDirectory)'
    includeRootFolder: false
    archiveType: 'zip'
    archiveFile: '$(Build.ArtifactStagingDirectory)/$(artifactName).zip'
    replaceExistingArchive: true
  displayName: "üì¶ Create versioned artifact archive"

# 7Ô∏è‚É£ –ü—É–±–ª–∏–∫–∞—Ü–∏—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –≤ Azure DevOps
- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)/$(artifactName).zip'
    ArtifactName: '$(artifactName)'
    publishLocation: 'Container'
  displayName: "üöÄ Upload versioned artifact to Azure DevOps"
